import{_ as e}from"./preload-helper.BhLMWRjL.js";import{p as t,u as n}from"./url-utils.Di_X7-wz.js";import{n as o,o as i,p as s,B as a,q as d,r}from"./setting-utils.L9rfhgGT.js";import{s as c}from"./zh_TW.B7fWNfys.js";function l(){function e(e){if(e.hasAttribute("data-icon-initialized"))return;e.setAttribute("data-icon-initialized","true");const t=e.querySelector("[data-loading-indicator]"),n=e.querySelector("[data-icon-element]"),o=n?.getAttribute("icon");if(t&&n){if(t.style.display="inline-flex",n.classList.remove("opacity-100"),n.classList.add("opacity-0"),n.addEventListener("load",()=>{s()}),n.addEventListener("error",()=>{o&&console.warn(`Failed to load icon: ${o}`)}),window.MutationObserver){const e=new MutationObserver(()=>{i()&&e.disconnect()});e.observe(n,{childList:!0,subtree:!0,attributes:!0}),setTimeout(()=>{e.disconnect(),i()},5e3)}setTimeout(()=>{i()},100)}function i(){return!!(n.shadowRoot&&n.shadowRoot.children.length>0)&&(s(),!0)}function s(){t.style.display="none",n.classList.remove("opacity-0"),n.classList.add("opacity-100")}}if(document.querySelectorAll("[data-icon-container]").forEach(e),window.MutationObserver){new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{if(t.nodeType===Node.ELEMENT_NODE){const n=t;n.hasAttribute?.("data-icon-container")?e(n):n.querySelectorAll("[data-icon-container]").forEach(e)}})})}).observe(document.body,{childList:!0,subtree:!0})}}const m=Object.freeze(Object.defineProperty({__proto__:null,initIconLoader:l},Symbol.toStringTag,{value:"Module"})),u=!!document.getElementById("wallpaper-wrapper");function p(e,t){document.addEventListener("click",n=>{let o=document.getElementById(e);if(!o)return;let i=n.target;if(i instanceof Node){for(let e of t){let t=document.getElementById(e);if(t==i||t?.contains(i))return}o.classList.add("float-panel-closed")}})}function h(){document.querySelectorAll(".katex-display:not([data-scrollbar-initialized])").forEach(e=>{if(!e.parentNode)return;const t=document.createElement("div");t.className="katex-display-container",e.parentNode.insertBefore(t,e),t.appendChild(e),t.style.cssText="\n\t\t\toverflow-x: auto;\n\t\t",e.setAttribute("data-scrollbar-initialized","true")})}function w(){requestAnimationFrame(()=>{const e=document.getElementById("banner");e&&e.classList.remove("opacity-0","scale-105");const t=document.querySelector('.block.lg\\:hidden[alt="Mobile banner image of the blog"]');t&&(t.classList.remove("opacity-0","scale-105"),t.classList.add("opacity-100"))})}p("display-setting",["display-setting","display-settings-switch"]),p("nav-menu-panel",["nav-menu-panel","nav-menu-switch"]),p("search-panel",["search-panel","search-bar","search-switch"]),p("wallpaper-mode-panel",["wallpaper-mode-panel","wallpaper-mode-switch"]),p("theme-mode-panel",["theme-mode-panel","scheme-switch"]);const g=()=>{window.swup.hooks.on("link:click",(e,{el:n})=>{document.documentElement.style.setProperty("--content-delay","0ms");const o=n.getAttribute("href")||"",i=(()=>{try{return new URL(o,window.location.origin).pathname}catch{return o}})();if(t(i,window.location.pathname)||document.documentElement.classList.add("is-page-transitioning"),u){const e=document.getElementById("navbar-wrapper");if(e){const t=window.innerHeight*(d/100)-88;document.documentElement.scrollTop>=t&&e.classList.add("navbar-hidden")}}}),window.swup.hooks.on("content:replace",()=>{B(),h(),e(async()=>{const{initIconLoader:e}=await Promise.resolve().then(()=>m);return{initIconLoader:e}},void 0).then(({initIconLoader:e})=>{e()});if(null!==document.getElementById("toc-wrapper")){const e=document.querySelector("table-of-contents");e&&"function"==typeof e.init&&setTimeout(()=>{e.init()},100)}const t=document.getElementById("navbar");if(t){"semifull"===t.getAttribute("data-transparent-mode")&&"function"==typeof window.initSemifullScrollDetection&&window.initSemifullScrollDetection()}}),window.swup.hooks.on("visit:start",e=>{const o=document.getElementById("progress-bar");o&&(o.classList.remove("finishing","done"),o.offsetWidth,o.classList.add("loading"));const i=document.querySelector("body"),s=t(e.to.url,n("/"));s?i.classList.add("lg:is-home"):i.classList.remove("lg:is-home");const a=document.querySelector(".banner-home-text-overlay");a&&(s?a.classList.remove("hidden"):a.classList.add("hidden"));const d=document.getElementById("navbar");if(d){d.setAttribute("data-is-home",s.toString());"semifull"===d.getAttribute("data-transparent-mode")&&"function"==typeof window.initSemifullScrollDetection&&window.initSemifullScrollDetection()}const r=window.innerWidth<1024;if(r){const e=document.getElementById("post-list-container");e&&(e.style.transition="none")}const c=document.getElementById("wallpaper-wrapper"),l=document.querySelector(".absolute.w-full.z-30");r&&c&&l?s?(l.style.transition="none",c.style.display="",setTimeout(()=>{c.classList.remove("mobile-hide-banner")},100),setTimeout(()=>{l.classList.remove("mobile-main-no-banner"),setTimeout(()=>{l.style.transition=""},50)},150)):(c.classList.add("mobile-hide-banner"),setTimeout(()=>{l.classList.add("mobile-main-no-banner")},100)):!r&&c&&(c.style.display="",c.classList.remove("mobile-hide-banner"),l&&l.classList.remove("mobile-main-no-banner"));const m=document.getElementById("page-height-extend");m&&m.classList.remove("hidden");let u=document.getElementById("toc-wrapper");u&&u.classList.add("toc-not-ready")}),window.swup.hooks.on("page:view",()=>{I(),B();const e=document.getElementById("page-height-extend");e&&e.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"});window.innerWidth<1024&&setTimeout(()=>{const e=document.getElementById("post-list-container");e&&(e.style.transition="")},600);const t=localStorage.getItem("theme")||c.themeColor.defaultMode;let n=!1;n="system"===t?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"===t;const o=n?s.darkTheme:s.lightTheme;document.documentElement.getAttribute("data-theme")!==o&&document.documentElement.setAttribute("data-theme",o),setTimeout(()=>{if(document.getElementById("tcomment")){const e=new CustomEvent("firefly:page:loaded",{detail:{path:window.location.pathname,timestamp:Date.now()}});document.dispatchEvent(e),console.log("Layout: 触发 firefly:page:loaded 事件，路径:",window.location.pathname)}},300)}),window.swup.hooks.on("visit:end",e=>{const t=document.getElementById("progress-bar");t&&(t.classList.remove("loading"),t.classList.add("finishing"),setTimeout(()=>{t.classList.remove("finishing"),t.classList.add("done"),setTimeout(()=>{t.classList.remove("done")},300)},200)),setTimeout(()=>{const e=document.getElementById("page-height-extend");e&&e.classList.add("hidden");const t=document.getElementById("toc-wrapper");t&&t.classList.remove("toc-not-ready"),document.documentElement.classList.remove("is-page-transitioning")},200)})};window?.swup?.hooks?g():document.addEventListener("swup:enable",g);let f,y=document.getElementById("back-to-top-btn"),b=document.getElementById("toc-wrapper"),L=document.getElementById("navbar-wrapper");function v(){const e=document.documentElement.scrollTop,t=window.innerHeight*(r/100),n=[];y&&n.push(()=>{e>t?y.classList.remove("hide"):y.classList.add("hide")}),u&&b&&n.push(()=>{e>t?b.classList.remove("toc-hide"):b.classList.add("toc-hide")}),u&&L&&n.push(()=>{const t=window.innerHeight*(d/100)-88;e>=t?L.classList.add("navbar-hidden"):L.classList.remove("navbar-hidden")}),n.length>0&&requestAnimationFrame(()=>{n.forEach(e=>e())})}window.addEventListener("scroll",()=>{f&&cancelAnimationFrame(f),f=requestAnimationFrame(v)},{passive:!0}),window.onresize=()=>{let e=Math.floor(window.innerHeight*(a/100));e-=e%4,document.documentElement.style.setProperty("--banner-height-extend",`${e}px`)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{w(),h()}):(w(),h());const E=()=>window.location.pathname.includes("/posts/")||window.location.pathname.includes("/post/");function I(){const e=document.getElementById("main-grid");if(!e)return;const t=E(),n=e.getAttribute("data-sidebar-position")||"left",o="true"===e.getAttribute("data-show-right-sidebar-on-post"),i="both"===n||t&&"left"===n&&o?"grid-cols-1 md:grid-cols-[17.5rem_1fr] xl:grid-cols-[17.5rem_1fr_17.5rem]":"grid-cols-1 md:grid-cols-[17.5rem_1fr]";["grid-cols-1","md:grid-cols-[17.5rem_1fr]","xl:grid-cols-[17.5rem_1fr_17.5rem]"].forEach(t=>e.classList.remove(t)),i.split(" ").forEach(t=>t&&e.classList.add(t))}function B(){const e=E();document.querySelectorAll(".widget-hide-on-post").forEach(t=>{e?t.classList.add("hidden"):t.classList.remove("hidden")}),document.querySelectorAll(".widget-hide-on-non-post").forEach(t=>{e?t.classList.remove("hidden"):t.classList.add("hidden")})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{I(),B(),o(),i(),l()}):(I(),B(),o(),i(),l());
