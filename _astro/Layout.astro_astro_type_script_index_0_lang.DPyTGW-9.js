import{_ as B}from"./preload-helper.BlTxHScW.js";import{p as S,u as k}from"./url-utils.CSfNOSGE.js";import{k as E,l as v,m as L,B as A,n as f,o as M}from"./setting-utils.BDYsZ__a.js";import{s as x}from"./navBarConfig.CxEzoo3s.js";import"./zh_TW.Cs8FgTnN.js";function w(){function o(n){if(n.hasAttribute("data-icon-initialized"))return;n.setAttribute("data-icon-initialized","true");const t=n.querySelector("[data-loading-indicator]"),e=n.querySelector("[data-icon-element]"),i=e?.getAttribute("icon");if(!t||!e)return;function a(){return e.shadowRoot&&e.shadowRoot.children.length>0?(s(),!0):!1}function s(){t.style.display="none",e.classList.remove("opacity-0"),e.classList.add("opacity-100")}function r(){t.style.display="inline-flex",e.classList.remove("opacity-100"),e.classList.add("opacity-0")}if(r(),e.addEventListener("load",()=>{s()}),e.addEventListener("error",()=>{i&&console.warn(`Failed to load icon: ${i}`)}),window.MutationObserver){const d=new MutationObserver(()=>{a()&&d.disconnect()});d.observe(e,{childList:!0,subtree:!0,attributes:!0}),setTimeout(()=>{d.disconnect(),a()},5e3)}setTimeout(()=>{a()},100)}document.querySelectorAll("[data-icon-container]").forEach(o),window.MutationObserver&&new MutationObserver(t=>{t.forEach(e=>{e.addedNodes.forEach(i=>{if(i.nodeType===Node.ELEMENT_NODE){const a=i;a.hasAttribute?.("data-icon-container")?o(a):a.querySelectorAll("[data-icon-container]").forEach(o)}})})}).observe(document.body,{childList:!0,subtree:!0})}const _=Object.freeze(Object.defineProperty({__proto__:null,initIconLoader:w},Symbol.toStringTag,{value:"Module"})),b=!!document.getElementById("banner-wrapper");function c(o,n){document.addEventListener("click",t=>{let e=document.getElementById(o);if(!e)return;let i=t.target;if(i instanceof Node){for(let a of n){let s=document.getElementById(a);if(s==i||s?.contains(i))return}e.classList.add("float-panel-closed")}})}c("display-setting",["display-setting","display-settings-switch"]);c("nav-menu-panel",["nav-menu-panel","nav-menu-switch"]);c("search-panel",["search-panel","search-bar","search-switch"]);c("wallpaper-mode-panel",["wallpaper-mode-panel","wallpaper-mode-switch"]);c("theme-mode-panel",["theme-mode-panel","scheme-switch"]);function y(){document.querySelectorAll(".katex-display:not([data-scrollbar-initialized])").forEach(n=>{if(!n.parentNode)return;const t=document.createElement("div");t.className="katex-display-container",n.parentNode.insertBefore(t,n),t.appendChild(n),t.style.cssText=`
			overflow-x: auto;
		`,n.setAttribute("data-scrollbar-initialized","true")})}function T(){requestAnimationFrame(()=>{const o=document.getElementById("banner");o&&o.classList.remove("opacity-0","scale-105");const n=document.querySelector('.block.lg\\:hidden[alt="Mobile banner image of the blog"]');n&&(n.classList.remove("opacity-0","scale-105"),n.classList.add("opacity-100"))})}const I=()=>{window.swup.hooks.on("link:click",()=>{if(document.documentElement.style.setProperty("--content-delay","0ms"),document.documentElement.classList.add("is-page-transitioning"),b){const o=document.getElementById("navbar-wrapper");if(o&&document.body.classList.contains("lg:is-home")){const n=window.innerHeight*(f/100)-88;document.documentElement.scrollTop>=n&&o.classList.add("navbar-hidden")}}}),window.swup.hooks.on("content:replace",()=>{if(y(),B(async()=>{const{initIconLoader:e}=await Promise.resolve().then(()=>_);return{initIconLoader:e}},void 0).then(({initIconLoader:e})=>{e()}),document.getElementById("toc-wrapper")!==null){const e=document.querySelector("table-of-contents");e&&typeof e.init=="function"&&setTimeout(()=>{e.init()},100)}const t=document.getElementById("navbar");t&&t.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection()}),window.swup.hooks.on("visit:start",o=>{const n=document.querySelector("body"),t=S(o.to.url,k("/"));t?n.classList.add("lg:is-home"):n.classList.remove("lg:is-home");const e=document.querySelector(".banner-text-overlay");e&&(t?e.classList.remove("hidden"):e.classList.add("hidden"));const i=document.getElementById("navbar");i&&(i.setAttribute("data-is-home",t.toString()),i.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection());const a=window.innerWidth<1024;if(a){const l=document.getElementById("post-list-container");l&&(l.style.transition="none")}const s=document.getElementById("banner-wrapper"),r=document.querySelector(".absolute.w-full.z-30");a&&s&&r?t?(r.style.transition="none",s.style.display="",setTimeout(()=>{s.classList.remove("mobile-hide-banner")},100),setTimeout(()=>{r.classList.remove("mobile-main-no-banner"),setTimeout(()=>{r.style.transition=""},50)},150)):(s.classList.add("mobile-hide-banner"),setTimeout(()=>{r.classList.add("mobile-main-no-banner")},100)):!a&&s&&(s.style.display="",s.classList.remove("mobile-hide-banner"),r&&r.classList.remove("mobile-main-no-banner"));const d=document.getElementById("page-height-extend");d&&d.classList.remove("hidden");let g=document.getElementById("toc-wrapper");g&&g.classList.add("toc-not-ready")}),window.swup.hooks.on("page:view",()=>{const o=document.getElementById("page-height-extend");o&&o.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),window.innerWidth<1024&&setTimeout(()=>{const s=document.getElementById("post-list-container");s&&(s.style.transition="")},600);const t=localStorage.getItem("theme")||x.themeColor.defaultMode||"light";let e=!1;t==="system"?e=window.matchMedia("(prefers-color-scheme: dark)").matches:e=t==="dark";const i=e?L.darkTheme:L.lightTheme;document.documentElement.getAttribute("data-theme")!==i&&document.documentElement.setAttribute("data-theme",i),setTimeout(()=>{if(document.getElementById("tcomment")){const s=new CustomEvent("firefly:page:loaded",{detail:{path:window.location.pathname,timestamp:Date.now()}});document.dispatchEvent(s),console.log("Layout: 触发 firefly:page:loaded 事件，路径:",window.location.pathname)}},300)}),window.swup.hooks.on("visit:end",o=>{setTimeout(()=>{const n=document.getElementById("page-height-extend");n&&n.classList.add("hidden");const t=document.getElementById("toc-wrapper");t&&t.classList.remove("toc-not-ready"),document.documentElement.classList.remove("is-page-transitioning")},200)})};window?.swup?.hooks?I():document.addEventListener("swup:enable",I);let m=document.getElementById("back-to-top-btn"),u=document.getElementById("toc-wrapper"),p=document.getElementById("navbar-wrapper");function C(){const o=document.documentElement.scrollTop,n=window.innerHeight*(f/100),t=[];m&&t.push(()=>{o>n?m.classList.remove("hide"):m.classList.add("hide")}),b&&u&&t.push(()=>{o>n?u.classList.remove("toc-hide"):u.classList.add("toc-hide")}),b&&p&&t.push(()=>{const i=document.body.classList.contains("lg:is-home")&&window.innerWidth>=1024?M:f,a=window.innerHeight*(i/100)-88;o>=a?p.classList.add("navbar-hidden"):p.classList.remove("navbar-hidden")}),t.length>0&&requestAnimationFrame(()=>{t.forEach(e=>e())})}let h;window.addEventListener("scroll",()=>{h&&cancelAnimationFrame(h),h=requestAnimationFrame(C)},{passive:!0});window.onresize=()=>{let o=Math.floor(window.innerHeight*(A/100));o=o-o%4,document.documentElement.style.setProperty("--banner-height-extend",`${o}px`)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{T(),y()}):(T(),y());document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{E(),v(),w()}):(E(),v(),w());
