import{_ as k}from"./preload-helper.BlTxHScW.js";import{p as E,u as C}from"./url-utils.BO0hhQIW.js";import{n as T,o as I,p as B,B as M,q as _,r as P}from"./setting-utils.Cgpts_XR.js";import{s as q}from"./zh_TW.BgXONg39.js";function b(){function n(t){if(t.hasAttribute("data-icon-initialized"))return;t.setAttribute("data-icon-initialized","true");const o=t.querySelector("[data-loading-indicator]"),e=t.querySelector("[data-icon-element]"),a=e?.getAttribute("icon");if(!o||!e)return;function s(){return e.shadowRoot&&e.shadowRoot.children.length>0?(i(),!0):!1}function i(){o.style.display="none",e.classList.remove("opacity-0"),e.classList.add("opacity-100")}function r(){o.style.display="inline-flex",e.classList.remove("opacity-100"),e.classList.add("opacity-0")}if(r(),e.addEventListener("load",()=>{i()}),e.addEventListener("error",()=>{a&&console.warn(`Failed to load icon: ${a}`)}),window.MutationObserver){const d=new MutationObserver(()=>{s()&&d.disconnect()});d.observe(e,{childList:!0,subtree:!0,attributes:!0}),setTimeout(()=>{d.disconnect(),s()},5e3)}setTimeout(()=>{s()},100)}document.querySelectorAll("[data-icon-container]").forEach(n),window.MutationObserver&&new MutationObserver(o=>{o.forEach(e=>{e.addedNodes.forEach(a=>{if(a.nodeType===Node.ELEMENT_NODE){const s=a;s.hasAttribute?.("data-icon-container")?n(s):s.querySelectorAll("[data-icon-container]").forEach(n)}})})}).observe(document.body,{childList:!0,subtree:!0})}const N=Object.freeze(Object.defineProperty({__proto__:null,initIconLoader:b},Symbol.toStringTag,{value:"Module"})),w=!!document.getElementById("wallpaper-wrapper");function c(n,t){document.addEventListener("click",o=>{let e=document.getElementById(n);if(!e)return;let a=o.target;if(a instanceof Node){for(let s of t){let i=document.getElementById(s);if(i==a||i?.contains(a))return}e.classList.add("float-panel-closed")}})}c("display-setting",["display-setting","display-settings-switch"]);c("nav-menu-panel",["nav-menu-panel","nav-menu-switch"]);c("search-panel",["search-panel","search-bar","search-switch"]);c("wallpaper-mode-panel",["wallpaper-mode-panel","wallpaper-mode-switch"]);c("theme-mode-panel",["theme-mode-panel","scheme-switch"]);function y(){document.querySelectorAll(".katex-display:not([data-scrollbar-initialized])").forEach(t=>{if(!t.parentNode)return;const o=document.createElement("div");o.className="katex-display-container",t.parentNode.insertBefore(o,t),o.appendChild(t),o.style.cssText=`
			overflow-x: auto;
		`,t.setAttribute("data-scrollbar-initialized","true")})}function S(){requestAnimationFrame(()=>{const n=document.getElementById("banner");n&&n.classList.remove("opacity-0","scale-105");const t=document.querySelector('.block.lg\\:hidden[alt="Mobile banner image of the blog"]');t&&(t.classList.remove("opacity-0","scale-105"),t.classList.add("opacity-100"))})}const x=()=>{window.swup.hooks.on("link:click",(n,{el:t})=>{document.documentElement.style.setProperty("--content-delay","0ms");const o=t.getAttribute("href")||"",e=(()=>{try{return new URL(o,window.location.origin).pathname}catch{return o}})();if(E(e,window.location.pathname)||document.documentElement.classList.add("is-page-transitioning"),w){const s=document.getElementById("navbar-wrapper");if(s){const i=window.innerHeight*(_/100)-88;document.documentElement.scrollTop>=i&&s.classList.add("navbar-hidden")}}}),window.swup.hooks.on("content:replace",()=>{if(m(),y(),k(async()=>{const{initIconLoader:e}=await Promise.resolve().then(()=>N);return{initIconLoader:e}},void 0).then(({initIconLoader:e})=>{e()}),document.getElementById("toc-wrapper")!==null){const e=document.querySelector("table-of-contents");e&&typeof e.init=="function"&&setTimeout(()=>{e.init()},100)}const o=document.getElementById("navbar");o&&o.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection()}),window.swup.hooks.on("visit:start",n=>{const t=document.getElementById("progress-bar");t&&(t.classList.remove("finishing","done"),t.offsetWidth,t.classList.add("loading"));const o=document.querySelector("body"),e=E(n.to.url,C("/"));e?o.classList.add("lg:is-home"):o.classList.remove("lg:is-home");const a=document.querySelector(".banner-home-text-overlay");a&&(e?a.classList.remove("hidden"):a.classList.add("hidden"));const s=document.getElementById("navbar");s&&(s.setAttribute("data-is-home",e.toString()),s.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection());const i=window.innerWidth<1024;if(i){const u=document.getElementById("post-list-container");u&&(u.style.transition="none")}const r=document.getElementById("wallpaper-wrapper"),d=document.querySelector(".absolute.w-full.z-30");i&&r&&d?e?(d.style.transition="none",r.style.display="",setTimeout(()=>{r.classList.remove("mobile-hide-banner")},100),setTimeout(()=>{d.classList.remove("mobile-main-no-banner"),setTimeout(()=>{d.style.transition=""},50)},150)):(r.classList.add("mobile-hide-banner"),setTimeout(()=>{d.classList.add("mobile-main-no-banner")},100)):!i&&r&&(r.style.display="",r.classList.remove("mobile-hide-banner"),d&&d.classList.remove("mobile-main-no-banner"));const l=document.getElementById("page-height-extend");l&&l.classList.remove("hidden");let L=document.getElementById("toc-wrapper");L&&L.classList.add("toc-not-ready"),window.scrollTo({top:0,behavior:"smooth"})}),window.swup.hooks.on("page:view",()=>{v(),m();const n=document.getElementById("page-height-extend");n&&n.classList.remove("hidden"),window.innerWidth<1024&&setTimeout(()=>{const i=document.getElementById("post-list-container");i&&(i.style.transition="")},600);const o=localStorage.getItem("theme")||q.themeColor.defaultMode;let e=!1;o==="system"?e=window.matchMedia("(prefers-color-scheme: dark)").matches:e=o==="dark";const a=e?B.darkTheme:B.lightTheme;document.documentElement.getAttribute("data-theme")!==a&&document.documentElement.setAttribute("data-theme",a),setTimeout(()=>{if(document.getElementById("tcomment")){const i=new CustomEvent("firefly:page:loaded",{detail:{path:window.location.pathname,timestamp:Date.now()}});document.dispatchEvent(i),console.log("Layout: 触发 firefly:page:loaded 事件，路径:",window.location.pathname)}},300)}),window.swup.hooks.on("visit:end",n=>{const t=document.getElementById("progress-bar");t&&(t.classList.remove("loading"),t.classList.add("finishing"),setTimeout(()=>{t.classList.remove("finishing"),t.classList.add("done"),setTimeout(()=>{t.classList.remove("done")},300)},200)),setTimeout(()=>{const o=document.getElementById("page-height-extend");o&&o.classList.add("hidden");const e=document.getElementById("toc-wrapper");e&&e.classList.remove("toc-not-ready"),document.documentElement.classList.remove("is-page-transitioning")},200)})};window?.swup?.hooks?x():document.addEventListener("swup:enable",x);let f=document.getElementById("back-to-top-btn"),p=document.getElementById("toc-wrapper"),h=document.getElementById("navbar-wrapper");function H(){const n=document.documentElement.scrollTop,t=window.innerHeight*(P/100),o=[];f&&o.push(()=>{n>t?f.classList.remove("hide"):f.classList.add("hide")}),w&&p&&o.push(()=>{n>t?p.classList.remove("toc-hide"):p.classList.add("toc-hide")}),w&&h&&o.push(()=>{const e=window.innerHeight*(_/100)-88;n>=e?h.classList.add("navbar-hidden"):h.classList.remove("navbar-hidden")}),o.length>0&&requestAnimationFrame(()=>{o.forEach(e=>e())})}let g;window.addEventListener("scroll",()=>{g&&cancelAnimationFrame(g),g=requestAnimationFrame(H)},{passive:!0});window.onresize=()=>{let n=Math.floor(window.innerHeight*(M/100));n=n-n%4,document.documentElement.style.setProperty("--banner-height-extend",`${n}px`)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{S(),y()}):(S(),y());const A=()=>window.location.pathname.includes("/posts/")||window.location.pathname.includes("/post/");function v(){const n=document.getElementById("main-grid");if(!n)return;const t=A(),o=n.getAttribute("data-sidebar-position")||"left",e=n.getAttribute("data-tablet-sidebar")||"left",a=n.getAttribute("data-show-both-sidebars-on-post")==="true",s=t&&o!=="both"&&a;let i;if(o==="both"||s?(s&&o==="right"?"right":e)==="right"?i="grid-cols-1 md:grid-cols-[1fr_17.5rem] xl:grid-cols-[17.5rem_1fr_17.5rem]":i="grid-cols-1 md:grid-cols-[17.5rem_1fr] xl:grid-cols-[17.5rem_1fr_17.5rem]":o==="right"?i="grid-cols-1 md:grid-cols-[1fr_17.5rem]":i="grid-cols-1 md:grid-cols-[17.5rem_1fr]",["grid-cols-1","md:grid-cols-[17.5rem_1fr]","md:grid-cols-[1fr_17.5rem]","xl:grid-cols-[17.5rem_1fr_17.5rem]"].forEach(r=>n.classList.remove(r)),i.split(" ").forEach(r=>r&&n.classList.add(r)),o==="right"){const r=document.getElementById("right-sidebar"),d=document.getElementById("swup-container"),l=n.querySelector(".footer");s?(r?.classList.add("xl:col-start-3"),d?.classList.add("xl:col-start-2","xl:col-end-3"),l&&(l.classList.remove("md:col-start-1","xl:col-start-1"),l.classList.add("xl:col-start-2"))):(r?.classList.remove("xl:col-start-3"),d?.classList.remove("xl:col-start-2","xl:col-end-3"),l&&(l.classList.add("md:col-start-1","xl:col-start-1"),l.classList.remove("xl:col-start-2")))}}function m(){const n=A();document.querySelectorAll(".widget-hide-on-post").forEach(t=>{n?t.classList.add("hidden"):t.classList.remove("hidden")}),document.querySelectorAll(".widget-hide-on-non-post").forEach(t=>{n?t.classList.remove("hidden"):t.classList.add("hidden")})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{v(),m(),T(),I(),b()}):(v(),m(),T(),I(),b());
